{"version":3,"sources":["../src/archiver.js"],"names":["FileArchiver","app","files","response","zip","attachment","pipe","s3Downloader","each","file","fileObject","getObject","append","name","get","finalize"],"mappings":";;;;;;;;AAAA;;;;AACA;;;;AACA;;;;AACA;;;;;;;;IAEqBA,Y;AAEjB,0BAAYC,GAAZ,EAAsC;AAAA,YAArBC,KAAqB,uEAAb,EAAa;AAAA,YAATC,QAAS;;AAAA;;AAElC,aAAKF,GAAL,GAAWA,GAAX;AACA,aAAKC,KAAL,GAAaA,KAAb;AACA,aAAKC,QAAL,GAAgBA,QAAhB;AACH;;;;mCAES;;AAEN,gBAAMF,MAAM,KAAKA,GAAjB;AACA,gBAAMC,QAAQ,KAAKA,KAAnB;AACA;AACA,gBAAME,MAAM,wBAAS,KAAT,CAAZ;AACA,gBAAMD,WAAW,KAAKA,QAAtB;;AAGAA,qBAASE,UAAT,CAAoB,cAApB;AACAD,gBAAIE,IAAJ,CAASH,QAAT;;AAGA,gBAAMI,eAAe,gBAAON,GAAP,EAAYE,QAAZ,CAArB;;AAIA,6BAAEK,IAAF,CAAON,KAAP,EAAc,UAACO,IAAD,EAAU;;AAGpB,oBAAMC,aAAaH,aAAaI,SAAb,CAAuBF,IAAvB,CAAnB;;AAEAL,oBAAIQ,MAAJ,CAAWF,UAAX,EAAuB,EAACG,MAAM,iBAAEC,GAAF,CAAML,IAAN,EAAY,cAAZ,CAAP,EAAvB;;AAGA;;AAIH,aAZD;;AAeAL,gBAAIW,QAAJ;;AAGA,mBAAO,IAAP;AAGH;;;;;;kBA/CgBf,Y","file":"archiver.js","sourcesContent":["import archiver from 'archiver'\nimport _ from 'lodash'\nimport path from 'path'\nimport S3 from './s3'\n\nexport default class FileArchiver{\n\n    constructor(app, files = [], response){\n\n        this.app = app;\n        this.files = files;\n        this.response = response;\n    }\n\n    download(){\n\n        const app = this.app;\n        const files = this.files;\n        //const uploadDir = app.get('storageDir');\n        const zip = archiver('zip');\n        const response = this.response;\n\n\n        response.attachment('download.zip');\n        zip.pipe(response);\n\n\n        const s3Downloader = new S3(app, response);\n\n\n\n        _.each(files, (file) => {\n\n\n            const fileObject = s3Downloader.getObject(file);\n\n            zip.append(fileObject, {name: _.get(file, 'originalName')});\n\n\n            /*const filePath = path.join(uploadDir, _.get(file, 'name'));\n            zip.file(filePath, {name: _.get(file, 'originalName')});*/\n\n\n        });\n\n\n        zip.finalize();\n\n\n        return this;\n\n\n    }\n}"]}