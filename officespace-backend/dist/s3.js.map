{"version":3,"sources":["../src/s3.js"],"names":["S3","app","response","file","s3","options","Bucket","Key","get","getObject","createReadStream","filename","attachment","fileObject","pipe","Expires","url","getSignedUrl"],"mappings":";;;;;;;;AAAA;;;;AACA;;;;;;IACqBA,E;AAEjB,gBAAYC,GAAZ,EAAiBC,QAAjB,EAA0B;AAAA;;AACtB,aAAKD,GAAL,GAAWA,GAAX;AACA,aAAKC,QAAL,GAAgBA,QAAhB;AAEH;;;;kCAISC,I,EAAK;AACX,gBAAMC,KAAK,KAAKH,GAAL,CAASG,EAApB;;AAEA,gBAAMC,UAAU;AACZC,wCADY;AAEZC,qBAAK,iBAAEC,GAAF,CAAML,IAAN,EAAY,MAAZ;AAFO,aAAhB;;AAKD,mBAAOC,GAAGK,SAAH,CAAaJ,OAAb,EAAsBK,gBAAtB,EAAP;AAKF;;;iCACQP,I,EAAK;;AAEV,gBAAMC,KAAK,KAAKH,GAAL,CAASG,EAApB;AACA,gBAAMF,WAAW,KAAKA,QAAtB;;AAEA;;AAEA,gBAAMS,WAAW,iBAAEH,GAAF,CAAML,IAAN,EAAY,cAAZ,CAAjB;AACAD,qBAASU,UAAT,CAAoBD,QAApB;;AAEA,gBAAMN,UAAU;AACZC,wCADY;AAEZC,qBAAK,iBAAEC,GAAF,CAAML,IAAN,EAAY,MAAZ;AAFO,aAAhB;AAIA,gBAAMU,aAAaT,GAAGK,SAAH,CAAaJ,OAAb,EAAsBK,gBAAtB,EAAnB;;AAEAG,uBAAWC,IAAX,CAAgBZ,QAAhB;AAIH;;;uCAEcC,I,EAAK;;AAEhB,gBAAMC,KAAK,KAAKH,GAAL,CAASG,EAApB;AACA,gBAAMC,UAAU;AACZC,wCADY;AAEZC,qBAAK,iBAAEC,GAAF,CAAML,IAAN,EAAY,MAAZ,CAFO;AAGZY,yBAAS,IAHG,CAGG;AAHH,aAAhB;;AAOA,gBAAMC,MAAMZ,GAAGa,YAAH,CAAgB,WAAhB,EAA6BZ,OAA7B,CAAZ;;AAEA,mBAAOW,GAAP;AAEH;;;;;;kBA5DgBhB,E","file":"s3.js","sourcesContent":["import _ from 'lodash'\r\nimport {s3Bucket} from './config'\r\nexport default class S3{\r\n\r\n    constructor(app, response){\r\n        this.app = app;\r\n        this.response = response;\r\n\r\n    }\r\n\r\n\r\n\r\n    getObject(file){\r\n        const s3 = this.app.s3;\r\n\r\n        const options  ={\r\n            Bucket: s3Bucket,\r\n            Key: _.get(file, 'name')\r\n        };\r\n\r\n       return s3.getObject(options).createReadStream();\r\n\r\n\r\n\r\n\r\n    }\r\n    download(file){\r\n\r\n        const s3 = this.app.s3;\r\n        const response = this.response;\r\n\r\n        // get Object from S3 service\r\n\r\n        const filename = _.get(file, 'originalName');\r\n        response.attachment(filename);\r\n\r\n        const options  ={\r\n            Bucket: s3Bucket,\r\n            Key: _.get(file, 'name')\r\n        };\r\n        const fileObject = s3.getObject(options).createReadStream();\r\n\r\n        fileObject.pipe(response);\r\n\r\n\r\n\r\n    }\r\n\r\n    getDownloadUrl(file){\r\n\r\n        const s3 = this.app.s3;\r\n        const options  ={\r\n            Bucket: s3Bucket,\r\n            Key: _.get(file, 'name'),\r\n            Expires: 3600, // one hour expires.\r\n        };\r\n\r\n\r\n        const url = s3.getSignedUrl('getObject', options);\r\n\r\n        return url;\r\n\r\n    }\r\n\r\n\r\n\r\n}"]}