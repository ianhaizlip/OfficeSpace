{"version":3,"sources":["../../src/models/auth.js"],"names":["Auth","app","createToken","bind","model","userId","expire","user","cb","db","_id","collection","insertOne","err","token","req","get","query","find","limit","toArray","tokenObjects","tokenObj"],"mappings":";;;;;;;;AAAA;;AACA;;;;;;;;IAEqBA,I;AAGpB,gBAAYC,GAAZ,EAAgB;AAAA;;AAEf,SAAKA,GAAL,GAAWA,GAAX;;AAGA,SAAKC,WAAL,GAAmB,KAAKA,WAAL,CAAiBC,IAAjB,CAAsB,IAAtB,CAAnB;;AAEA,SAAKC,KAAL,GAAa;AACZC,cAAQ,IADI;AAEZC,cAAQ;AAFI,KAAb;AAMA;;;;gCAGWC,I,EAAmC;AAAA,UAA7BD,MAA6B,uEAApB,IAAoB;AAAA,UAAdE,EAAc,uEAAT,YAAM,CAAE,CAAC;;;AAE9C,UAAIJ,QAAQ,KAAKA,KAAjB;;AAGA,UAAMK,KAAK,KAAKR,GAAL,CAASQ,EAApB;;AAEAL,YAAMC,MAAN,GAAeE,KAAKG,GAApB;AACAN,YAAME,MAAN,GAAeA,MAAf;;AAEAG,SAAGE,UAAH,CAAc,QAAd,EAAwBC,SAAxB,CAAkCR,KAAlC,EAAyC,UAACS,GAAD,EAAMC,KAAN,EAAgB;AACxD,eAAON,GAAGK,GAAH,EAAQT,KAAR,CAAP;AAEA,OAHD;AAMA;;;8BAESW,G,EAAmB;AAAA,UAAdP,EAAc,uEAAT,YAAM,CAAE,CAAC;;;AAE5B,UAAMM,QAAQC,IAAIC,GAAJ,CAAQ,eAAR,CAAd;;AAEA,UAAG,CAACF,KAAJ,EAAU;AACT,eAAON,GAAG,KAAH,CAAP;AACA;;AAGD,UAAMC,KAAK,KAAKR,GAAL,CAASQ,EAApB;;AAEA,UAAMQ,QAAQ;AACbP,aAAK,sBAAaI,KAAb;AADQ,OAAd;AAGAL,SAAGE,UAAH,CAAc,QAAd,EAAwBO,IAAxB,CAA6BD,KAA7B,EAAoCE,KAApC,CAA0C,CAA1C,EAA6CC,OAA7C,CAAqD,UAACP,GAAD,EAAMQ,YAAN,EAAuB;;AAE3E,YAAMC,WAAW,iBAAEN,GAAF,CAAMK,YAAN,EAAoB,KAApB,EAA2B,IAA3B,CAAjB;;AAEA,YAAGR,QAAQ,IAAR,IAAgBS,QAAnB,EAA4B;;AAE3B,iBAAOd,GAAG,IAAH,CAAP;AACA;;AAED,eAAOA,GAAG,KAAH,CAAP;AAGA,OAZD;AAeA;;;;;;kBAlEmBR,I","file":"auth.js","sourcesContent":["import {ObjectID} from 'mongodb'\r\nimport _ from 'lodash'\r\n\r\nexport default class Auth {\r\n\r\n\r\n\tconstructor(app){\r\n\r\n\t\tthis.app = app;\r\n\r\n\r\n\t\tthis.createToken = this.createToken.bind(this);\r\n\r\n\t\tthis.model = {\r\n\t\t\tuserId: null,\r\n\t\t\texpire: null,\r\n\t\t}\r\n\r\n\r\n\t}\r\n\r\n\r\n\tcreateToken(user, expire = null, cb = () => {}){\r\n\r\n\t\tlet model = this.model;\r\n\r\n\r\n\t\tconst db = this.app.db;\r\n\r\n\t\tmodel.userId = user._id;\r\n\t\tmodel.expire = expire;\r\n\r\n\t\tdb.collection('tokens').insertOne(model, (err, token) => {\r\n\t\t\treturn cb(err, model);\r\n\r\n\t\t});\r\n\r\n\r\n\t}\r\n\r\n\tcheckAuth(req, cb = () => {}){\r\n\r\n\t\tconst token = req.get('authorization');\r\n\r\n\t\tif(!token){\r\n\t\t\treturn cb(false);\r\n\t\t}\r\n\r\n\r\n\t\tconst db = this.app.db;\r\n\r\n\t\tconst query = {\r\n\t\t\t_id: new ObjectID(token)\r\n\t\t}\r\n\t\tdb.collection('tokens').find(query).limit(1).toArray((err, tokenObjects) => {\r\n\r\n\t\t\tconst tokenObj = _.get(tokenObjects, '[0]', null);\r\n\r\n\t\t\tif(err === null && tokenObj){\r\n\r\n\t\t\t\treturn cb(true);\r\n\t\t\t}\r\n\r\n\t\t\treturn cb(false);\r\n\t\t\t\r\n\r\n\t\t});\r\n\r\n\t\t\r\n\t}\r\n\r\n\r\n\r\n\r\n\r\n}"]}