{"version":3,"sources":["../../src/models/auth.js"],"names":["Auth","app","createToken","bind","model","userId","expire","user","cb","db","_id","collection","insertOne","err","token","req","get","query","find","limit","toArray","tokenObjects","tokenObj"],"mappings":";;;;;;;;AAAA;;AACA;;;;;;;;IAEqBA,I;AAEpB,eAAYC,GAAZ,EAAgB;AAAA;;AAEf,OAAKA,GAAL,GAAWA,GAAX;;AAEA,OAAKC,WAAL,GAAmB,KAAKA,WAAL,CAAiBC,IAAjB,CAAsB,IAAtB,CAAnB;;AAEA,OAAKC,KAAL,GAAa;AACZC,WAAQ,IADI;AAEZC,WAAQ;AAFI,GAAb;AAIA;;;;8BAEWC,I,EAAmC;AAAA,OAA7BD,MAA6B,uEAApB,IAAoB;AAAA,OAAdE,EAAc,uEAAT,YAAM,CAAE,CAAC;;;AAE9C,OAAIJ,QAAQ,KAAKA,KAAjB;;AAEA,OAAMK,KAAK,KAAKR,GAAL,CAASQ,EAApB;;AAEAL,SAAMC,MAAN,GAAeE,KAAKG,GAApB;AACAN,SAAME,MAAN,GAAeA,MAAf;;AAEAG,MAAGE,UAAH,CAAc,QAAd,EAAwBC,SAAxB,CAAkCR,KAAlC,EAAyC,UAACS,GAAD,EAAMC,KAAN,EAAgB;AACxD,WAAON,GAAGK,GAAH,EAAQT,KAAR,CAAP;AACA,IAFD;AAIA;;;4BAESW,G,EAAmB;AAAA,OAAdP,EAAc,uEAAT,YAAM,CAAE,CAAC;;;AAE5B,OAAMM,QAAQC,IAAIC,GAAJ,CAAQ,eAAR,CAAd;;AAEA,OAAG,CAACF,KAAJ,EAAU;AACT,WAAON,GAAG,KAAH,CAAP;AACA;;AAED,OAAMC,KAAK,KAAKR,GAAL,CAASQ,EAApB;;AAEA,OAAMQ,QAAQ;AACbP,SAAK,sBAAaI,KAAb;AADQ,IAAd;AAGAL,MAAGE,UAAH,CAAc,QAAd,EAAwBO,IAAxB,CAA6BD,KAA7B,EAAoCE,KAApC,CAA0C,CAA1C,EAA6CC,OAA7C,CAAqD,UAACP,GAAD,EAAMQ,YAAN,EAAuB;;AAE3E,QAAMC,WAAW,iBAAEN,GAAF,CAAMK,YAAN,EAAoB,KAApB,EAA2B,IAA3B,CAAjB;;AAEA,QAAGR,QAAQ,IAAR,IAAgBS,QAAnB,EAA4B;;AAE3B,YAAOd,GAAG,IAAH,CAAP;AACA;;AAED,WAAOA,GAAG,KAAH,CAAP;AACA,IAVD;AAWA;;;;;;kBArDmBR,I","file":"auth.js","sourcesContent":["import {ObjectID} from 'mongodb'\nimport _ from 'lodash'\n\nexport default class Auth {\n\n\tconstructor(app){\n\n\t\tthis.app = app;\n\n\t\tthis.createToken = this.createToken.bind(this);\n\n\t\tthis.model = {\n\t\t\tuserId: null,\n\t\t\texpire: null,\n\t\t}\n\t}\n\n\tcreateToken(user, expire = null, cb = () => {}){\n\n\t\tlet model = this.model;\n\n\t\tconst db = this.app.db;\n\n\t\tmodel.userId = user._id;\n\t\tmodel.expire = expire;\n\n\t\tdb.collection('tokens').insertOne(model, (err, token) => {\n\t\t\treturn cb(err, model);\n\t\t});\n\n\t}\n\n\tcheckAuth(req, cb = () => {}){\n\n\t\tconst token = req.get('authorization');\n\n\t\tif(!token){\n\t\t\treturn cb(false);\n\t\t}\n\n\t\tconst db = this.app.db;\n\n\t\tconst query = {\n\t\t\t_id: new ObjectID(token)\n\t\t}\n\t\tdb.collection('tokens').find(query).limit(1).toArray((err, tokenObjects) => {\n\n\t\t\tconst tokenObj = _.get(tokenObjects, '[0]', null);\n\n\t\t\tif(err === null && tokenObj){\n\n\t\t\t\treturn cb(true);\n\t\t\t}\n\n\t\t\treturn cb(false);\t\n\t\t});\n\t}\n}"]}